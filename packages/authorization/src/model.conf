# Multi-App RBAC Model with Dynamic Conditions
#
# Request format: (sub, app, tenant, obj, act, resourceOwnerId)
# Policy format: (sub, app, tenant, obj, act, eft, condition)
# Grouping format: (user, role, app, tenant)
#
# Conditions are typed enum values evaluated by custom functions:
# - "" (empty): no condition, always applies
# - "owner": isOwner(sub, resourceOwnerId) must be true
# - "shared": isShared(sub, resourceId) must be true

[request_definition]
r = sub, app, tenant, obj, act, resourceOwnerId

[policy_definition]
p = sub, app, tenant, obj, act, eft, condition

[role_definition]
g = _, _, _, _

[policy_effect]
e = some(where (p.eft == allow)) && !some(where (p.eft == deny))

[matchers]
m = g(r.sub, p.sub, r.app, r.tenant) && \
    r.app == p.app && \
    r.tenant == p.tenant && \
    r.obj == p.obj && \
    r.act == p.act && \
    (p.condition == "" || \
     (p.condition == "owner" && isOwner(r.sub, r.resourceOwnerId)))
