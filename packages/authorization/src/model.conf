# Multi-App Multi-Tenant RBAC Model
#
# Architecture:
# - DB owns user→role mapping (user_role_assignments table)
# - Casbin owns role→permission evaluation
#
# Request format: (sub, role, app, tenant, obj, act, resourceOwnerId)
# - sub: user ID (for audit and owner conditions)
# - role: resolved from DB lookup, NOT from Casbin g()
#
# Policy format: (role, app, tenant, obj, act, eft, condition)
#
# Role inheritance: g(child_role, parent_role) - optional
#
# Conditions:
# - "" (empty): no condition, always applies
# - "owner": isOwner(sub, resourceOwnerId) must be true

[request_definition]
r = sub, role, app, tenant, obj, act, resourceOwnerId

[policy_definition]
p = role, app, tenant, obj, act, eft, condition

[role_definition]
g = _, _

[policy_effect]
e = some(where (p.eft == allow)) && !some(where (p.eft == deny))

[matchers]
m = (r.role == p.role || g(r.role, p.role)) && \
    r.app == p.app && \
    r.tenant == p.tenant && \
    r.obj == p.obj && \
    r.act == p.act && \
    (p.condition == "" || \
     (p.condition == "owner" && isOwner(r.sub, r.resourceOwnerId)))
